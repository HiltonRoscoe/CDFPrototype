# CVR Prototypes

## Purpose

This prototype demonstrates:

- How an XML instance can be used to define an interactive sample ballot.
- How a marked XML instance can be transformed into an XML instance of the [NIST 1500-103 Cast Vote Record (CVR) Common Data Format (CDF)](https://github.com/usnistgov/castvoterecords).

## Principles of Operation

This prototype operates by binding form elements constituting the ballot to the structure of an XML file [Nov14-EML-410-RCV.xml](../xml/Nov14-EML-410-RCV.xml) (RCV) or [Nov14-EML-410.xml](../xml/Nov14-EML-410.xml) (plurality). Repeating elements in the EML schema instance become repeatable elements in the form (such as contests, contest options, etc.). The ballot layout engine is written in [XML Forms Architecture](https://en.wikipedia.org/wiki/XFA), which is embedded into a PDF.

> The PDF includes an embedded XML data source, however, a new one can be put in its place to render a different ballot.

Once the user is satisfied with their selections, they may click the `Export EML` to view the EML source or `Export CVR` to transform the ballot into a CVR.

### EML 410

The prototype uses a modified version of EML 7.0 410 to represent the layout of the ballot, which is also used to store the contest selections prior to conversion to the CVR CDF.

See the [EML 410 extension document](./EML-410_extensions.md) for additional details on its use.

### CVR CDF

The CVR CDF is generated by transforming the extended EML 410 XML instance using an [XSL Transformation](../xml/eml2cvr.xsl).

## Limitations

- The number of ranks cannot be controlled, it will always equal the number of contest options in a particular contest, up to 5 (`plurality.pdf`) or up to the number of contest options (`universal.pdf`).

## Running the Prototype

The prototype is distributed as a PDF that has an EML instance and XML transformation (XSLT) embedded inside. This prototype requires Adobe Acrobat Reader 11 or higher. It **will not** run on non-Adobe PDF viewers, such as those included with operating systems or web browsers.

[Download Adobe Reader](http://www.adobe.com/go/reader_download)

## Importing a custom data source

### Approach 1

(requires Acrobat Standard or Pro)

1. Click on Tools
2. Click on Forms -> More Form Options
3. Select Import Data
4. You'll select a valid 410 EML file. Use files located at [xml](../xml) for examples. The PDF will bind to the fields of the form.

### Approach 2

(requires Acrobat Reader, Standard or Pro)

1. Open the [plurality_turncoat.xdp](./plurality_turncoat.xdp) in a text editor.
2. Modify or replace the section between the "modify EML XML instance below" and "modify EML XML instance above" comments.
3. Open modified `xdp` in Adobe Acrobat.

## License

The prototype is licensed under the GNU Affero General Public License, Version 3.0. For other licensing options, please contact Hilton Roscoe LLC.
